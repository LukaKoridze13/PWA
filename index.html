<!-- index.html -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="manifest" href="/manifest.json">

    <title>Web Push Subscription</title>
  </head>
  <body>
    <button id="subscribe">Subscribe to Push Notifications</button>
    <button id="sendNotification">Send Notification</button>
    <!-- New button for sending notifications -->

    <script>
      async function subscribe() {
        const registration = await navigator.serviceWorker.register(
          "service-worker.js"
        );
        const subscription = await registration.pushManager.subscribe({
          userVisibleOnly: true,
          applicationServerKey: "BOFWDAaOvqQ1cBTxg_IwQ1cRNJ5Z3QouAiIgzo4JRJXdw_CnlrSPJRxaeiIlfH23-VERIKuhKzJXi49ERjykQ3E",
        });

        // Send the subscription to the server
        await fetch("http://localhost:3000/subscribe", {
          method: "POST",
          body: JSON.stringify(subscription),
          headers: {
            "Content-Type": "application/json",
          },
        });

        alert("Subscribed to push notifications!");
      }

      document.getElementById("subscribe").addEventListener("click", subscribe);

      // Function to send a notification
      async function sendNotification() {
        const message = "This is a test push notification message."; // Modify as needed

        // Send a request to the server to trigger push notification
        const response = await fetch("http://localhost:3000/send-notification", {
          method: "POST",
          body: JSON.stringify({ message }),
          headers: {
            "Content-Type": "application/json",
          },
        });

        if (response.ok) {
          alert("Push notification sent successfully!");
        } else {
          alert("Failed to send push notification.");
        }
      }

      document
        .getElementById("sendNotification")
        .addEventListener("click", sendNotification);
    </script>
  </body>
</html>
